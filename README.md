# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание данных
### Интерфейс IProduct
Предназначен для хранения данных о продуктах, продаваемых на сайте. 
Содержит следующие поля:
- id, типа string - идентификатор продукта
- description, типа string - описание продукта
- image, типа string - адрес изображения
- title, типа string - заголовок продукта
- category, типа string - категория продукта
- price, типа number - стоимость продукта

### Интерфейс ICart
Предназначен для хранения информации о состоянии корзины. Хранит в себе список продуктов. Имеет методы для управления состоянием корзины.
Содержит следующие поля и методы:
- products, типа IProduct[] - коллекция продуктов в корзине
- count, типа number - количество продуктов в корзине
- cost, типа number - полная стоимость корзины
- метод addProduct - добавляет в корзину продукт, если его там не было
- метод removeProduct - удаляет продукт из корзины, если он там был
- метод clear - очищает корзину

### Интерфейс IDeliveryInfo
Предназначен для хранения базовой информации о заказе
Содержит следующие поля:
- payment, типа TPaymentType (возможные значения 'online' и 'deliver') - информация о способе оплаты заказа
- address, типа string - адрес получателя

### Интерфейс ICustomerInfo
Предназначен для хранения информации о получателе
Содержит следующие поля:
- email, типа string - адрес электронной почты получателя
- phone, типа string - номер телефона получателя

### Интерфейс IOrderProductsInfo
Предназначен для хранения информации о продуктах в заказе
Содержит следующие поля:
- total, типа number - полная стоимость заказа
- items, типа string[] - идентификаторы продуктов в заказе

### Интерфейс IOrderInfo
Предназначен для хранения информации о заказе, унаследован от IDeliveryInfo, ICustomerInfo и IOrderProductsInfo, поэтому содержит в себе все поля из указанных интерфейсов.

### Интерфейс IOrderResult
Предназначен для хранения информации о созданном заказе
Содержит следующие поля:
- id, типа string - идентификатор созданного заказа
- total, типа number - итоговая стоимость созданного заказа

### Интерфейс IValidationResult
Предназначен для хранения результатов валидации
Содержит следующие поля:
- valid, типа boolean - результат валидации
- errors, типа string[] - список ошибок валидации

### Интерфейс IVisualState
Предназначен для хранения текущего состояния представления
Содержит следующие поля:
- cartModalIsVisible, типа boolean - содержит признак того, что на странице отображено модальное окно с содержимым корзины (требуется для перерисовки корзины при удалении продукта из корзины)


## Модели данных
### Класс Cart
Реализует интерфейс ICart. Конструктор принимает интерфейс IEvents (брокер сообщений). Внутри содержит protected поле с продуктами и методы для изменения корзины. При добавлении или удалении элементов, а также при очистке корзины, генерирует событие 'cart:change'.

### Класс AppData
Предназначен для хранения текущего состояния приложения. Содержит следующие поля:
- products, типа IProducts[] - коллекция продуктов, полученная с сервера
- deliveryInfo, типа IDeliveryInfo - содержит в себе данные о способе оплаты и адресе получателя
- customerInfo, типа ICustomerInfo - содержит в себе данные о номере телефона и адресе электронной почты получателя
- clearOrderInfo - метод, очищает deliveryInfo и customerInfo


## Компоненты представления
### Component
Базовый класс для создания любого визуального компонента. Содержит в себе следующие методы:
- toggleClass - переключает (добавляет или удаляет) класс у элемента, переданного в качестве аргумента
- setText - устанавливает текстовое содержимое у элемента, переданного в качестве аргумента
- setDisabled - устанавливает признак disabled у элемента, переданного в качестве аргумента
- setHidden - скрывает элемент, переданный в качестве аргумента
- setVisible - отображает элемент, переданный в качестве аргумента
- setImage - устанавливает адрес изображения и значение тега alt для элемента изображения, переданного в качестве аргумента
- render - метод предназначен для финальной отрисовки визуального компонента. Метод render принимает в качестве аргумента объект с данными, которые сопоставляются с полями унаследованных классов.

### Form
Базовый класс для всех форм в проекте. 
Унаследован от Component.
Каждая форма должна содержать в себе кнопку с типом submit и поле для отображения ошибок.
В конструкторе принимает дополнительный параметр имени формы - formName.
Содержит сеттеры:
- valid - валидны ли данные на форме
- error - ошибка валидации
Содержит следующие методы:
- render - метод предназначен для финальной отрисовки визуального компонента. Метод render принимает в качестве аргумента объект с данными, которые сопоставляются с полями унаследованных классов.
- onFormChange - protected метод, который вызывается из наследуемых классов. Генерирует событие "formName:change", где formName - имя формы, передаваемое в конструкторе

### DeliveryInfo
Представляет собой компонент формы для выбора способа оплаты и ввода адреса получателя заказа.
Унаследован от Form.
Содержит сеттеры:
- address - адрес получателя
- payment - способ оплаты
Содержит следующий метод:
- emitChanges - protected метод, вызывает метод onFormChange родительского класса, генерируя соответствующее событие
При изменении каких-либо данных, происходит, генерация соответствующего события

### CustomerInfo
Унаследован от Form.
Представляет собой компонент формы для ввода адреса электронной почты и номера телефона получателя.
Содержит сеттеры:
- phone - номер телефона получателя
- email - адрес электронной почты получателя
Содержит следующий метод:
- emitChanges - protected метод, вызывает метод onFormChange родительского класса, генерируя соответствующее событие
При изменении каких-либо данных, происходит, генерация соответствующего события

### Modal
Унаследован от Component.
Класс для представления модального окна.
Содержит сеттер content, типа HTMLElement. Данный элемент отрисовывается внутри модального окна.
Определены методы:
- open - отображает модальное окно
- close - закрывает модальное окно
- render - вставляет нужный контент внутрь модального окна и отображает его

### Page
Унаследован от Component.
Представляет собой компонент для отображения главной страницы. В конструктор принимает дополнительно объект с обработчиком клика на кнопке корзины.
Содержит сеттеры:
- counter - количество товаров в корзине
- catalog - список товаров в каталоге

### CardBase
Унаследован от Component.
Базовый класс для карточек с продуктами. 
Содержит сеттеры:
- category - категории продукта
- title - заголовка продукта
- price - стоимости продукта
- image - изображения продукта

### Card
Унаследован от CardBase.
Предназначен для отображения информации о продукте на главной странице. В конструктор дополнительно принимает объект с обработчиком события клика на контейнер продукта

### CardPreview
Унаследован от CardBase.
Предназначен для отображения информации о продукте во всплывающем окне при клике на продукт на главной странице. В конструктор дополнительно принимает объект с обработчиками событий для клика на кнопку удаления или добавления в корзину. Имеет два дополнительных сеттера по сравнению с родительским объектом:
- description - описание продукта
- inCart - Признак нахождения товара в корзине - необходим для правильной установки текста на кнопке ("Убрать" или "Купить")

### CartItemView
Унаследован от Component.
Предназначен для отображения информации о продукте во всплывающем окне корзины. В конструктор дополнительно принимает объект с обработчиком события для клика на кнопку удаления продукта из корзины.
Содержит сеттеры:
- index - порядковый номер
- title - название продукта
- price - цена продукта

### CartView
Унаследован от Component.
Предназначен для отображения информации о корзине во всплывающем окне. В конструктор дополнительно принимает объект с обработчиком события для кнопки оформления заказа.
Содержит сеттеры:
- items - список товаров в корзине
- total - полная стоимость товара в корзине. Если в корзине есть продукт с бесценной стоимостью, то вся корзина имеет бесценную стоимость и оформление заказа невозможно.
- allowPlaceOrder - признак блокирования кнопки оформления заказа. Выставляется в true, если в корзине нет товаров или есть товары с бесценной стоимостью.

### Success
Предназначен для отображения информации об успешно созданном заказе. В конструктор дополнительно принимает объект с обработчиком события для кнопки продолжения покупок.
Содержит следующие сеттеры:
- description - текст о том, сколько списано синапсов


## Описание событий
### products:loaded
Возникает сразу после загрузки продуктов сервера. При возникновении такого события необходимо отрисовать продукты на странице

### card:click
Возникает, когда пользователь кликает на продукт на главной странице. В качестве аргумента получает интерфейс IProduct. При возникновении такого события необходимо открыть модальное окно с информацией о продукте

### cart:add
Возникает, когда пользователь кликает на кнопку "Купить" в окне с информацией о продукте. В качестве аргумента получает интерфейс IProduct. При возникновении такого события необходимо добавить товар в корзину, пересчитать количество товаров в корзине и их общую стоимость

### cart:remove
Возникает, когда пользователь кликает на кнопку "Убрать" в окне с информацией о продукте. В качестве аргумента получает интерфейс IProduct. При возникновении такого события необходимо удалить товар из корзины, пересчитать количество товаров в корзине и их общую стоимость

### cart:open
Возникает, когда пользователь кликает на иконку корзины на главной странице. При возникновении такого события необходимо открыть модальное окно со списком товаров в корзине и их обзей стоимостью

### cart:change
Возникает, когда изменяется состав корзины. При возникновении такого события необходимо пересчитать количество товаров в корзине и их общую стоимость. Если сейчас на экране модальное окно со списком товаров в корзине, то необходимо перерисовать список товаров.

### cart:placeOrder
Возникает, когда пользователь кликает на кнопку "Оформить" в модальном окне корзины. При возникновении такого события необходимо отобразить окно с выбором способа оплаты и адреса покупателя.

### deliveryForm:change
Возникает, когда пользователь изменяет адрес или способ оплаты. При возникновении такого события необходимо провалидировать введенные данные и принять решение об активации кнопки продолжения оформления заказа и вывести ошибку, если требуется.

### deliveryForm:submit
Возникает, когда пользователь нажал на кнопку "Далее" на форме выбора способа оплаты и адреса. При возникновении такого события необходимо отобразить новую форму с вводом номера телефона и адреса электронной почты покупателя.

### contactForm:change
Возникает, когда пользователь изменяет номер телефона или адрес электронной почты. При возникновении такого события необходимо провалидировать введенные данные и принять решение об активации кнопки создания заказа и вывести ошибку, если требуется.

### contactForm:submit
Возникает, когда пользователь нажал на кнопку "Оплатить" на форме ввода номера телефона и адрес электронной почты. При возникновении такого события необходимо попытаться отправить заказ на сервер. В случае успешной отправки отобразить модальное окно с сообщением об успешном создании заказа.

### modal:open
Возникает, когда открывается модальное окно

### modal:close
Возникает, когда закрывается модальное окно


## Класс WebLarekApi
Предназначен для работы с сервером. Содержит два метода:
- getProducts - метод получения продуктов с сервера. Результатом выполнения метода является Promise<IProduct[]>
- postOrder - метод для отправки заказа на сервер. Результатом выполнения метода является Promise<IOrderResult>


В проекте использован эмиттер для работы с событиями. Он реализован с помощью класса EventEmitter, реализующего интерфейс IEvents.
Для интерфейса IEvents определены методы:
- on - для навешивания обработчика при наступлении конкретного события 
- emit - для создания конкретного события 
- trigger - возвращает функцию для генерации конкретного события

